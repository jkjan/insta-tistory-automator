FROM openjdk:21-jdk-slim AS build
WORKDIR /app
COPY ../ /app

ARG SPRING_DATASOURCE_URL
ARG SPRING_DATASOURCE_USERNAME
ARG SPRING_DATSOURCE_PASSWORD
ARG SPRING_PROFILES_ACTIVE

ENV SPRING_DATASOURCE_URL $SPRING_DATASOURCE_URL
ENV SPRING_DATASOURCE_USERNAME $SPRING_DATASOURCE_USERNAME
ENV SPRING_DATSOURCE_PASSWORD $SPRING_DATSOURCE_PASSWORD
ENV SPRING_PROFILES_ACTIVE $SPRING_PROFILES_ACTIVE

RUN echo "SPRING_DATASOURCE_URL=${SPRING_DATASOURCE_URL}"
RUN echo "SPRING_DATASOURCE_USERNAME=${SPRING_DATASOURCE_USERNAME}"
RUN echo "SPRING_PROFILES_ACTIVE=${SPRING_PROFILES_ACTIVE}"

RUN ./gradlew build -i
CMD ["java", "-jar", "/app/app.jar"]
